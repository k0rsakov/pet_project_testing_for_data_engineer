# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –î–∞—Ç–∞-–∏–Ω–∂–µ–Ω–µ—Ä–∏–∏ | Testing in Data Engineering

https://www.notion.so/korsak0v/Data-Engineer-185c62fdf79345eb9da9928356884ea0

## –û –≤–∏–¥–µ–æ

üî• –•–æ—á–µ—à—å –Ω–∞—É—á–∏—Ç—å—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏ –ø–∞–π–ø–ª–∞–π–Ω—ã –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–π –¥–∞—Ç–∞-–∏–Ω–∂–µ–Ω–µ—Ä (data engineer)?
–≠—Ç–æ—Ç [—Ä–æ–ª–∏–∫](https://youtu.be/xf7PVXZ64Ag) ‚Äî –ø–æ–ª–Ω—ã–π –≥–∞–π–¥ "–æ—Ç –ê –¥–æ –Ø" –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –≤ Data Engineering: PyTest,
Airflow, –ø–æ–∫—Ä—ã—Ç–∏–µ, —é–Ω–∏—Ç- –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã, SQL, –º–æ–∫, patch –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏.

–°—Å—ã–ª–∫–∏:

- –ú–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ/–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ Data
  Engineering ‚Äî https://korsak0v.notion.site/Data-Engineer-185c62fdf79345eb9da9928356884ea0
- TG-–∫–∞–Ω–∞–ª ‚Äî https://t.me/DataLikeQWERTY
- Instagram ‚Äî https://www.instagram.com/i__korsakov/
- Habr ‚Äî https://habr.com/ru/users/k0rsakov/publications/articles/

üîç –ß—Ç–æ –≤ –≤–∏–¥–µ–æ:

- üõ†Ô∏è –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ data engineering –ø—Ä–æ–µ–∫—Ç–∞—Ö
- ‚ö° –†–∞–∑–±–æ—Ä PyTest, mock, patch –∏ fixtures –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ ETL/ELT –ª–æ–≥–∏–∫–∏
- üìà –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Python-—Ñ—É–Ω–∫—Ü–∏–∏, Airflow DAG –∏ –∑–∞–¥–∞—á–∏
- üìä –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ (coverage): –ø–æ—á–µ–º—É 100% ‚Äî –Ω–µ –≤—Å–µ–≥–¥–∞ 100%?
- üéØ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –∏ SQL ("–Ω–∞—Å—Ç–æ—è—â–∏–π" –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç!)
- üî• –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤, –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ unit/integration, naming –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚ö° –†–∞–∑–±–æ—Ä —Ç–∏–ø–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ –∏ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (–∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–≥–∞—Ç—å)
- üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- üí¨ –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏ —Å–æ–≤–µ—Ç—ã –ø–æ –ø—Ä–æ—Ü–µ—Å—Å—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–º–∞–Ω–¥–µ

üóÇÔ∏èGitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –∫–æ–¥–æ–º: https://github.com/k0rsakov/pet_project_testing_for_data_engineer

‚úâÔ∏è –í–æ–ø—Ä–æ—Å—ã, –æ–±—É—á–µ–Ω–∏–µ, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ ‚Äî –ø–∏—à–∏ –≤
–ª–∏—á–∫—É: https://korsak0v.notion.site/Data-Engineer-185c62fdf79345eb9da9928356884ea0

üí° –í –∫–æ–Ω—Ü–µ ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –∫–∞–∫ —Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–∞—Ö–æ–¥–∏—Ç—å –±–∞–≥–∏ –î–û –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞, —ç–∫–æ–Ω–æ–º–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞
—Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ –∏ –¥–µ–ª–∞—Ç—å —Å–≤–æ—é —Ä–∞–±–æ—Ç—É –≤ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ!

–¢–∞–π–º–∫–æ–¥—ã:

- 00:00 ‚Äì –ù–∞—á–∞–ª–æ
- 00:23 ‚Äì –û —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ (–¢–µ–æ—Ä–∏—è)
- 04:29 ‚Äì –ó–∞–ø—É—Å–∫ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞
- 05:50 ‚Äì –ó–∞–ø—É—Å–∫ –≤—Ç–æ—Ä–æ–≥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞
- 06:55 ‚Äì –ó–∞–ø—É—Å–∫ –∏ —Ä–∞–∑–±–æ—Ä —Ç—Ä–µ—Ç—å–µ–≥–æ —Ç–µ—Å—Ç–∞ —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º
- 09:31 ‚Äì –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª/–∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É/CLI
- 11:01 ‚Äì –†–∞–∑–±–æ—Ä –ø–ª–æ—Ö–æ–≥–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—è DAG –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- 14:13 ‚Äì –†–∞–∑–±–æ—Ä —Ö–æ—Ä–æ—à–µ–≥–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—è DAG –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- 18:31 ‚Äì –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ. –î–≤–∞ –ø–æ–¥—Ö–æ–¥–∞.
- 19:20 ‚Äì –†–∞–∑–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è DAG. –†—É—á–∫–∏. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã.
- 21:57 ‚Äì –¢–µ–≥–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- 25:50 ‚Äì –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
- 29:29 ‚Äì –†–∞–∑–±–æ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
- 33:25 ‚Äì –†–∞–∑–±–æ—Ä –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- 35:05 ‚Äì –†–∞–∑–±–æ—Ä —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∞–º–æ–≥–æ DAG –∏ –µ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤
- 42:24 ‚Äì –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã—Ö Airflow (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞—Å—Ç–æ—Ä–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã—Ö)
- 49:16 ‚Äì –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
- 49:41 ‚Äì –†–∞–∑–±–æ—Ä –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏ (coverage)
- 52:13 ‚Äì –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

#pytest #dataengineering #python #airflow #etl #testing #unittest #integrationtest #coverage #sql #dataengineer
#tutorial #bestpractice

## –û –ø—Ä–æ–µ–∫—Ç–µ

### –û —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äì —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏. –î–ª—è –¥–∞—Ç–∞-–∏–Ω–∂–µ–Ω–µ—Ä–∞ —Ç–µ—Å—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç:

- **–°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –æ—à–∏–±–∫–∏** –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –∞ –Ω–µ –Ω–∞ –ø—Ä–æ–¥–µ.
- **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö** ‚Äì –æ—à–∏–±–∫–∏ –≤ –ø–∞–π–ø–ª–∞–π–Ω–∞—Ö –º–æ–≥—É—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –æ—Ç—á—ë—Ç—ã, —Ä–µ—à–µ–Ω–∏—è –∏ –¥–µ–Ω—å–≥–∏.
- **–≠–∫–æ–Ω–æ–º–∏—Ç—å –≤—Ä–µ–º—è –∏ —Ä–µ—Å—É—Ä—Å—ã** ‚Äì –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç, —Å–æ–∫—Ä–∞—â–∞—è —Ä—É—á–Ω—É—é —Ä–∞–±–æ—Ç—É –∏ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞
  –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤.
- **–ü–æ–≤—ã—à–∞—Ç—å –¥–æ–≤–µ—Ä–∏–µ –∫ –ø—Ä–æ–¥—É–∫—Ç—É** ‚Äì —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –∫–æ–º–∞–Ω–¥—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤, –∑–∞–∫–∞–∑—á–∏–∫–æ–≤ –∏ –±–∏–∑–Ω–µ—Å–∞.
- **–£–ø—Ä–æ—â–∞—Ç—å —Ä–∞–∑–≤–∏—Ç–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–¥–∞** ‚Äì —Ç–µ—Å—Ç—ã –∑–∞—â–∏—â–∞—é—Ç –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–ª–æ–º–æ–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
  —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥–µ.

–•–æ—Ä–æ—à–∏–µ —Ç–µ—Å—Ç—ã ‚Äì —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ –≤—Å–µ–π –¥–∞—Ç–∞-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

#### –ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–í –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Ç–µ—Å—Ç—ã –ø—Ä–∏–Ω—è—Ç–æ –¥–µ–ª–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π ‚Äì –ø–æ –æ—Ö–≤–∞—Ç—É –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏—Ö –∑–∞–ø—É—Å–∫–∞. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞—é—Ç "
*–ø–∏—Ä–∞–º–∏–¥–æ–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è*":

1. **–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã** ‚Äì –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–∞–±–æ—Ç—É –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–ª–∞—Å—Å–æ–≤.
    - –ë—ã—Å—Ç—Ä—ã–µ, –ø—Ä–æ—Å—Ç—ã–µ, –ø–∏—à—É—Ç—Å—è –º–Ω–æ–≥–æ.
    - –ò–¥–µ–∞–ª—å–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –Ω–µ–±–æ–ª—å—à–æ–π –ª–æ–≥–∏–∫–∏.
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** ‚Äì –ø—Ä–æ–≤–µ—Ä—è—é—Ç, –∫–∞–∫ —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ.
    - –ù–∞–ø—Ä–∏–º–µ—Ä: —Ñ—É–Ω–∫—Ü–∏—è + –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, API + –æ—á–µ—Ä–µ–¥–∏, –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å–æ–≤.
    - –ú–µ–¥–ª–µ–Ω–Ω–µ–µ, —Å–ª–æ–∂–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
3. **End-to-end (E2E, —Å–∫–≤–æ–∑–Ω—ã–µ) —Ç–µ—Å—Ç—ã** ‚Äì –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å "–æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞" (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ DAG-–∞ –∏
   –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞).
    - –î–æ—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞—Ç—å, –ø–æ–∫—Ä—ã–≤–∞—é—Ç –º–µ–Ω—å—à–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
    - –ü—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å —Ü–µ–ª–∏–∫–æ–º.

**–ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –ø–∏—Ä–∞–º–∏–¥–∞?**

- –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤ –ø–∏—à—É—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ ‚Äì –æ–Ω–∏ –±—ã—Å—Ç—Ä—ã–µ –∏ –¥–µ—à—ë–≤—ã–µ.
- –ü–æ –º–µ—Ä–µ –¥–≤–∏–∂–µ–Ω–∏—è –≤–≤–µ—Ä—Ö –ø–æ –ø–∏—Ä–∞–º–∏–¥–µ —Ç–µ—Å—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è ‚Äú–¥–æ—Ä–æ–∂–µ‚Äù, –Ω–æ –¥–∞—é—Ç –±–æ–ª—å—à–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Ä–∞–±–æ—Ç–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.

**–ò—Ç–æ–≥:**  
–•–æ—Ä–æ—à–∞—è –∫—É–ª—å—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –ø–∏—Ä–∞–º–∏–¥—É: –º–Ω–æ–≥–æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤, –º–µ–Ω—å—à–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö, –∏ —Ç–æ–ª—å–∫–æ –Ω–µ–±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ
e2e.

![](readme_files/testing_pyramid_svg.svg)

### –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
python3.12 -m venv venv && \
source venv/bin/activate && \
pip install --upgrade pip && \
pip install poetry && \
poetry lock && \
poetry install
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Airflow —á–µ—Ä–µ–∑ Docker

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Airflow, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ [Dockerfile](Dockerfile)
–∏ [docker-compose.yaml](docker-compose.yaml).

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å Airflow, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
docker-compose up -d
```

–í–µ–±-—Å–µ—Ä–≤–µ—Ä Airflow –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç–µ http://localhost:8080/, –µ—Å–ª–∏ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–π —Ö–æ—Å—Ç, —Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–π—Ç–∏
–ø–æ —Ö–æ—Å—Ç—É http://0.0.0.0:8080/.

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –≤ —Ç–µ–∫—É—â—É—é —Å–±–æ—Ä–∫—É

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∫–∞–∫–æ–π-—Ç–æ –ø–∞–∫–µ—Ç –≤ —Ç–µ–∫—É—â—É—é —Å–±–æ—Ä–∫—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

* –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –≤ [Dockerfile](Dockerfile)
* –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É:

```bash
docker-compose build
```

* –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É:

```bash
docker-compose up -d
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ—Å—Ç–æ–≤:

```bash
python -m pytest tests/test_*
```

–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ —Å —Ç–µ—Å—Ç–∞–º–∏:

```bash
python -m pytest tests/dags/extensions_for_orchestration/test_extensions_dict.py::TestDictKeysInStr
```

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ç–µ–≥–æ–º:

```bash
python -m pytest -m unit
```

–ö–∞–∫ –∑–∞–º–µ–Ω–∏—Ç—å –º–µ—Ç–∞-—Å—Ç–æ—Ä –¥–ª—è Airflow –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏:

Airflow —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ `venv` –∏ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∫–æ–Ω–Ω–µ–∫—Ç, —á—Ç–æ –∑–∞–¥–∞—ë—Ç—Å—è –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é. –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ Airflow
–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É ‚Äì `airflow info`. –ê –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Ç–∞-—Å—Ç–æ—Ä–µ ‚Äì
`airflow config get-value database sql_alchemy_conn`. –¢–µ–ø–µ—Ä—å –º—ã –≤–∏–¥–∏–º –∫–∞–∫–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ë–î –¥–ª—è –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã—Ö.

–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ "*–¥–æ–º*" –¥–ª—è Airflow, —ç—Ç–æ –µ—Å—Ç—å –≤ `airflow info` ‚Äì `airflow_home`. –ò–¥—ë–º —Ç—É–¥–∞ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª
`airflow.cfg`. –ò—â–µ–º –∫–ª—é—á `sql_alchemy_conn`. –ò–∑–º–µ–Ω—è–µ–º –Ω–∞ (–ø—Ä–∏–º–µ—Ä) ‚Äì
`sql_alchemy_conn = postgresql+psycopg2://airflow:airflow@localhost:5432/airflow`

–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:

```bash
python -m pytest tests/
```

–ó–∞–ø—É—Å–∫ –ø–æ–∫—Ä—ã—Ç–∏—è:

```bash
python -m pytest --cov=. tests/ --cov-report=html
```

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1) –û—Å–Ω–æ–≤–Ω–æ–π —Å–æ–≤–µ—Ç ‚Äì –∫–æ–≥–¥–∞ –ø–∏—à–µ—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é, –¥–µ—Ä–∂–∏—Ç–µ –º—ã—Å–ª—å –æ —Ç–æ–º –∫–∞–∫ –≤—ã –±—É–¥–µ—Ç–µ –µ—ë —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å. –ï—Å–ª–∏ –≤—ã —É–∂–µ "*–∑–∞–¥—É–º–∞–ª–∏—Å—å*",
   —á—Ç–æ –Ω—É–∂–Ω–æ –º–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤, —Ç–æ –Ω–∞—á–∏–Ω–∞–π—Ç–µ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É.
    1) \*–í—Ä–µ–¥–Ω—ã–π —Å–æ–≤–µ—Ç. –ù–æ –µ—Å–ª–∏ –≤—ã –ø–∏—à–µ—Ç–µ –∫–∞–∫–æ–π-—Ç–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –∏–ª–∏ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –∫–æ–º–∞–Ω–¥–µ, —Ç–æ
       –±–µ–∑ —Ç–µ—Å—Ç–æ–≤ –Ω–∏–∫—É–¥–∞.
2) –Ø–≤–Ω–æ–µ –ª—É—á—à–µ –Ω–µ—è–≤–Ω–æ–≥–æ, –ø–æ—ç—Ç–æ–º—É –¥–∞–≤–∞–π—Ç–µ —Ç–∞–∫–æ–π –Ω–µ–π–º–∏–Ω–≥ —Ñ—É–Ω–∫—Ü–∏—è–º –∏ —Ç–µ—Å—Ç–∞–º, —á—Ç–æ–±—ã –±—ã–ª–æ –≤—Å—ë –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ. –ö –ø—Ä–∏–º–µ—Ä—É, –Ω–∞—à–∞
   –ø–µ—Ä–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `return_value` –Ω–∏—á–µ–≥–æ –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ñ—É–Ω–∫—Ü–∏–∏. –¢–∞–∫–∂–µ —ç—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –Ω–µ–π–º–∏–Ω–≥–∞ —Ç–µ—Å—Ç–æ–≤, –æ—Å–æ–±–µ–Ω–Ω–æ —ç—Ç–æ –ø–æ–ª–µ–∑–Ω–æ,
   –µ—Å–ª–∏ —Ç–µ—Å—Ç —É–ø–∞–¥—ë—Ç, —Ç–æ –±—É–¥–µ—Ç +- –ø–æ–Ω—è—Ç–Ω–æ —á—Ç–æ —ç—Ç–æ.
3) –ù–µ –ª–µ–Ω–∏—Ç–µ—Å—å –ø–∏—Å–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è —Ç–µ—Å—Ç–æ–≤. –û—Å–æ–±–µ–Ω–Ω–æ —Ç–µ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∫–∞—Å–∞—é—Ç—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ –∫—Ä–∞–µ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤.
4) –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –∫–∞–∫ –¥–µ–±–∞–≥ –º–µ—Ç–æ–¥–æ–≤ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–∞–∫ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç –∏–ª–∏ —Ç–µ—Å—Ç—ã –ø–æ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—â–µ
   –∑–∞–ø—É—Å—Ç–∏—Ç—å, —á–µ–º "*–æ—Ç–¥–µ–ª–∏—Ç—å*" —Ñ—É–Ω–∫—Ü–∏—é –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –µ—ë
5) –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç—ã –≤ CICD. –¢–∞–∫ –∫–∞–∫ –≤—ã –º–æ–∂–µ—Ç–µ "*—Ç–æ–Ω–∫–æ*" –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ç–µ—Å—Ç—ã, —Ç–æ –≤—ã "*—Ç–æ–Ω–∫–æ*" –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å CICD.
   –ö –ø—Ä–∏–º–µ—Ä—É, e2e-—Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –ø—Ä–∏ MR —É–∫–∞–∑–∞–Ω –∫–∞–∫–æ–π-—Ç–æ –ª—ç–π–±–ª. –ò–ª–∏ —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å
   —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã, –∞ –ø–æ—Ç–æ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ. –ü–æ—Ç–æ–º—É —á—Ç–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å
   –ø–æ–∫—Ä—ã—Ç—ã –≤ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞—Ö.
6) –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –º–æ–¥—É–ª—å `coverage`, –ø–æ—Ç–æ–º—É —á—Ç–æ 100% != 100%
